<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>DBI storr driver — storr_dbi • storr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="DBI storr driver — storr_dbi"><meta name="description" content='Object cache driver using the "DBI" package interface for storage.
This means that storr can work for any supported "DBI" driver
(though practically this works only for SQLite and Postgres until
some MySQL dialect translation is done).  To connect, you must
provide the driver object (e.g., RSQLite::SQLite(),
or RPostgres::Postgres() as the first argument.'><meta property="og:description" content='Object cache driver using the "DBI" package interface for storage.
This means that storr can work for any supported "DBI" driver
(though practically this works only for SQLite and Postgres until
some MySQL dialect translation is done).  To connect, you must
provide the driver object (e.g., RSQLite::SQLite(),
or RPostgres::Postgres() as the first argument.'></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">storr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/storr.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/external.html">external</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/richfitz/storr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>DBI storr driver</h1>
      <small class="dont-index">Source: <a href="https://github.com/richfitz/storr/blob/master/R/driver_dbi.R" class="external-link"><code>R/driver_dbi.R</code></a></small>
      <div class="d-none name"><code>storr_dbi.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Object cache driver using the "DBI" package interface for storage.
This means that storr can work for any supported "DBI" driver
(though practically this works only for <code>SQLite</code> and Postgres until
some MySQL dialect translation is done).  To connect, you must
provide the <em>driver</em> object (e.g., <code><a href="https://rsqlite.r-dbi.org/reference/SQLite.html" class="external-link">RSQLite::SQLite()</a></code>,
or <code><a href="https://rpostgres.r-dbi.org/reference/Postgres.html" class="external-link">RPostgres::Postgres()</a></code> as the first argument.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">storr_dbi</span><span class="op">(</span></span>
<span>  <span class="va">tbl_data</span>,</span>
<span>  <span class="va">tbl_keys</span>,</span>
<span>  <span class="va">con</span>,</span>
<span>  args <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  binary <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  hash_algorithm <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  default_namespace <span class="op">=</span> <span class="st">"objects"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">driver_dbi</span><span class="op">(</span></span>
<span>  <span class="va">tbl_data</span>,</span>
<span>  <span class="va">tbl_keys</span>,</span>
<span>  <span class="va">con</span>,</span>
<span>  args <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  binary <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  hash_algorithm <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-tbl-data">tbl_data<a class="anchor" aria-label="anchor" href="#arg-tbl-data"></a></dt>
<dd><p>Name for the table that maps hashes to values</p></dd>


<dt id="arg-tbl-keys">tbl_keys<a class="anchor" aria-label="anchor" href="#arg-tbl-keys"></a></dt>
<dd><p>Name for the table that maps keys to hashes</p></dd>


<dt id="arg-con">con<a class="anchor" aria-label="anchor" href="#arg-con"></a></dt>
<dd><p>Either A DBI connection or a DBI driver (see example)</p></dd>


<dt id="arg-args">args<a class="anchor" aria-label="anchor" href="#arg-args"></a></dt>
<dd><p>Arguments to pass, along with the driver, to
<code><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">DBI::dbConnect</a></code> if <code>con</code> is a driver.</p></dd>


<dt id="arg-binary">binary<a class="anchor" aria-label="anchor" href="#arg-binary"></a></dt>
<dd><p>Optional logical indicating if the values should be
stored in binary.  If possible, this is both (potentially
faster) and more accurate.  However, at present it is supported
only under very recent <code>DBI</code> and <code>RSQLite</code> packages, and for no
other DBI drivers, and is not actually any faster.  If not given
(i.e., <code>NULL</code>), then binary storage will be used where
possible when creating new tables, and where tables exist, we
use whatever was used in the existing tables.</p></dd>


<dt id="arg-hash-algorithm">hash_algorithm<a class="anchor" aria-label="anchor" href="#arg-hash-algorithm"></a></dt>
<dd><p>Name of the hash algorithm to use.  Possible
values are "md5", "sha1", and others supported by
<a href="https://rdrr.io/pkg/digest/man/digest.html" class="external-link">digest::digest</a>.  If not given, then we will default to
"md5".</p></dd>


<dt id="arg-default-namespace">default_namespace<a class="anchor" aria-label="anchor" href="#arg-default-namespace"></a></dt>
<dd><p>Default namespace (see <a href="storr.html">storr</a>).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Because the DBI package specifies a uniform interface for the
using DBI compliant databases, you need only to provide a
connection object.  storr does not do anything to help create the
connection object itself.</p>
<p>The DBI storr driver works by using two tables; one mapping keys
to hashes, and one mapping hashes to values.  Two table names need
to be provided here; they must be different and they should be
treated as opaque (don't use them for anything else - reading or
writing).  Apart from that the names do not matter.</p>
<p>Because of treatment of binary data by the underlying DBI drivers,
binary serialisation is not any faster (and might be slightly
slower than) string serialisation, in contrast with my experience
with other backends.</p>
<p>storr uses DBI's "prepared query" approach to safely interpolate
keys, namespaces and values into the database - this should allow
odd characters without throwing SQL syntax errors.  Table names
can't be interpolated in the same way - these storr simply quotes,
but validates beforehand to ensure that <code>tbl_data</code> and
<code>tbl_keys</code> do not contain quotes.</p>
<p>Be aware that <code>$destroy()</code> will close the connection to the
database.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"RSQLite"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">st</span> <span class="op">&lt;-</span> <span class="fu">storr</span><span class="fu">::</span><span class="fu">storr_dbi</span><span class="op">(</span><span class="st">"tblData"</span>, <span class="st">"tblKeys"</span>, <span class="fu">RSQLite</span><span class="fu">::</span><span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html" class="external-link">SQLite</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                         <span class="st">":memory:"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Set some data:</span></span></span>
<span class="r-in"><span>  <span class="va">st</span><span class="op">$</span><span class="fu">set</span><span class="op">(</span><span class="st">"foo"</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">st</span><span class="op">$</span><span class="fu">list</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># And retrieve the data:</span></span></span>
<span class="r-in"><span>  <span class="va">st</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"foo"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># These are the data tables; treat these as read only</span></span></span>
<span class="r-in"><span>  <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbListTables.html" class="external-link">dbListTables</a></span><span class="op">(</span><span class="va">st</span><span class="op">$</span><span class="va">driver</span><span class="op">$</span><span class="va">con</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># With recent RSQLite you'll get binary storage here:</span></span></span>
<span class="r-in"><span>  <span class="va">st</span><span class="op">$</span><span class="va">driver</span><span class="op">$</span><span class="va">binary</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># The entire storr part of the database can be removed using</span></span></span>
<span class="r-in"><span>  <span class="co"># "destroy"; this will also close the connection to the database</span></span></span>
<span class="r-in"><span>  <span class="va">st</span><span class="op">$</span><span class="fu">destroy</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># If you have a connection you want to reuse (which will the the</span></span></span>
<span class="r-in"><span>  <span class="co"># case if you are using an in-memory SQLite database for</span></span></span>
<span class="r-in"><span>  <span class="co"># multiple things within an application) it may be useful to</span></span></span>
<span class="r-in"><span>  <span class="co"># pass the connection object instead of the driver:</span></span></span>
<span class="r-in"><span>  <span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html" class="external-link">SQLite</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">":memory:"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">st</span> <span class="op">&lt;-</span> <span class="fu">storr</span><span class="fu">::</span><span class="fu">storr_dbi</span><span class="op">(</span><span class="st">"tblData"</span>, <span class="st">"tblKeys"</span>, <span class="va">con</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">st</span><span class="op">$</span><span class="fu">set</span><span class="op">(</span><span class="st">"foo"</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># You can then connect a different storr to the same underlying</span></span></span>
<span class="r-in"><span>  <span class="co"># storage</span></span></span>
<span class="r-in"><span>  <span class="va">st2</span> <span class="op">&lt;-</span> <span class="fu">storr</span><span class="fu">::</span><span class="fu">storr_dbi</span><span class="op">(</span><span class="st">"tblData"</span>, <span class="st">"tblKeys"</span>, <span class="va">con</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">st2</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"foo"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 0.87460066 0.17494063 0.03424133 0.32038573 0.40232824 0.19566983</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7] 0.40353812 0.06366146 0.38870131 0.97554784</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

