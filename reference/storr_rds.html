<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>rds object cache driver — storr_rds • storr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="rds object cache driver — storr_rds"><meta name="description" content="Object cache driver that saves objects using R's native
serialized file format (see saveRDS) on the
filesystem."><meta property="og:description" content="Object cache driver that saves objects using R's native
serialized file format (see saveRDS) on the
filesystem."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">storr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/storr.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/external.html">external</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/richfitz/storr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>rds object cache driver</h1>
      <small class="dont-index">Source: <a href="https://github.com/richfitz/storr/blob/master/R/driver_rds.R" class="external-link"><code>R/driver_rds.R</code></a></small>
      <div class="d-none name"><code>storr_rds.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Object cache driver that saves objects using R's native
serialized file format (see <a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a>) on the
filesystem.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">storr_rds</span><span class="op">(</span></span>
<span>  <span class="va">path</span>,</span>
<span>  compress <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  mangle_key <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  mangle_key_pad <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  hash_algorithm <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  default_namespace <span class="op">=</span> <span class="st">"objects"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">driver_rds</span><span class="op">(</span></span>
<span>  <span class="va">path</span>,</span>
<span>  compress <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  mangle_key <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  mangle_key_pad <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  hash_algorithm <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-path">path<a class="anchor" aria-label="anchor" href="#arg-path"></a></dt>
<dd><p>Path for the store.  <code><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir()</a></code> is a good choice
for ephemeral storage, The <code>rappdirs</code> package (on CRAN)
might be nice for persistent application data.</p></dd>


<dt id="arg-compress">compress<a class="anchor" aria-label="anchor" href="#arg-compress"></a></dt>
<dd><p>Compress the generated file?  This saves a small
amount of space for a reasonable amount of time.</p></dd>


<dt id="arg-mangle-key">mangle_key<a class="anchor" aria-label="anchor" href="#arg-mangle-key"></a></dt>
<dd><p>Mangle keys?  If TRUE, then the key is encoded
using base64 before saving to the filesystem.  See Details.</p></dd>


<dt id="arg-mangle-key-pad">mangle_key_pad<a class="anchor" aria-label="anchor" href="#arg-mangle-key-pad"></a></dt>
<dd><p>Logical indicating if the filenames created
when using <code>mangle_key</code> should also be "padded" with the <code>=</code>
character to make up a round number of bytes.  Padding is
required to satisfy the document that describes base64 encoding
(RFC 4648) but can cause problems in some applications (see
<a href="https://github.com/richfitz/storr/issues/43" class="external-link">this issue</a>).  The
default is to not pad <em>new</em> storr archives.  This should be
generally safe to leave alone.</p></dd>


<dt id="arg-hash-algorithm">hash_algorithm<a class="anchor" aria-label="anchor" href="#arg-hash-algorithm"></a></dt>
<dd><p>Name of the hash algorithm to use.  Possible
values are "md5", "sha1", and others supported by
<a href="https://rdrr.io/pkg/digest/man/digest.html" class="external-link">digest::digest</a>.  If not given, then we will default to "md5".</p></dd>


<dt id="arg-default-namespace">default_namespace<a class="anchor" aria-label="anchor" href="#arg-default-namespace"></a></dt>
<dd><p>Default namespace (see <a href="storr.html">storr</a>).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The <code>mangle_key</code> argument will run each key that is created
through a "base 64" encoding.  This means that keys that include
symbols that are invalid on filesystems (e.g, "/", ":") will be
replaced by harmless characters.  The RFC 4648 dialect is used
where "-" and "_" are used for character 62 and 63 (this differs
from most R base64 encoders).  This mangling is designed to be
transparent to the user – the storr will appear to store things
with unmangled keys but the names of the stored files will be
different.</p>
<p>Note that the (<em>namespace</em> is not mangled (at least not yet)
so needs to contain characters that are valid in a filename.</p>
<p>Because the actual file will be stored with mangled names it is
not safe to use the same path for a storr with and without
mangling.  So once an rds storr has been created its "mangledness"
is set.  Using <code>mangle_key = NULL</code> uses whatever mangledness
exists (or no mangledness if creating a new storr).</p>
    </div>
    <div class="section level2">
    <h2 id="corrupt-keys">Corrupt keys<a class="anchor" aria-label="anchor" href="#corrupt-keys"></a></h2>



<p>Some file synchronisation utilities like Dropbox can create file
that confuse an rds storr (e.g.,
<code>"myobject (Someone's conflicted copy)"</code>.  If
<code>mangle_key</code> is <code>FALSE</code> these cannot be detected but at
the same time are not a real problem for storr.  However, if
<code>mangle_key</code> is <code>TRUE</code> and keys are base64 encoded then
these conflicted copies can break parts of storr.</p>
<p>If you see a warning asking you to deal with these files, please
delete the offending files; the path will be printed along with
the files that are causing the problem.</p>
<p>Alternatively, you can try (assuming a storr object <code>st</code>)
running</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>st<span class="sc">$</span>driver<span class="sc">$</span><span class="fu">purge_corrupt_keys</span>()</span></code></pre><p></p></div>
<p>which will delete corrupted keys with no confirmation.  The
messages that are printed to screen will be printed by default at
most once per minute per namespace.  You can control this by
setting the R option <code>storr.corrupt.notice.period</code> - setting
this to <code>NA</code> suppresses the notice and otherwise it is
interpreted as the number of seconds.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create an rds storr in R's temporary directory:</span></span></span>
<span class="r-in"><span><span class="va">st</span> <span class="op">&lt;-</span> <span class="fu">storr_rds</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Store some data (10 random numbers against the key "foo")</span></span></span>
<span class="r-in"><span><span class="va">st</span><span class="op">$</span><span class="fu">set</span><span class="op">(</span><span class="st">"foo"</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">st</span><span class="op">$</span><span class="fu">list</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "foo"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># And retrieve the data:</span></span></span>
<span class="r-in"><span><span class="va">st</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"foo"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 0.68016292 0.49884561 0.64167935 0.66028435 0.09602416 0.76560016</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7] 0.76967480 0.99071231 0.97052090 0.38918276</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Keys that are not valid filenames will cause issues.  This will</span></span></span>
<span class="r-in"><span><span class="co"># cause an error:</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">st</span><span class="op">$</span><span class="fu">set</span><span class="op">(</span><span class="st">"foo/bar"</span>, <span class="va">letters</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The solution to this is to "mangle" the key names.  Storr can do</span></span></span>
<span class="r-in"><span><span class="co"># this for you:</span></span></span>
<span class="r-in"><span><span class="va">st2</span> <span class="op">&lt;-</span> <span class="fu">storr_rds</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span>, mangle_key <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">st2</span><span class="op">$</span><span class="fu">set</span><span class="op">(</span><span class="st">"foo/bar"</span>, <span class="va">letters</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">st2</span><span class="op">$</span><span class="fu">list</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "foo/bar"</span>
<span class="r-in"><span><span class="va">st2</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"foo/bar"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "a" "b" "c" "d" "e" "f" "g" "h" "i" "j" "k" "l" "m" "n" "o" "p" "q" "r" "s"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [20] "t" "u" "v" "w" "x" "y" "z"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Behind the scenes, storr is safely encoding the filenames with base64:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">st2</span><span class="op">$</span><span class="va">driver</span><span class="op">$</span><span class="va">path</span>, <span class="st">"keys"</span>, <span class="st">"objects"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Zm9vL2Jhcg"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Clean up the two storrs:</span></span></span>
<span class="r-in"><span><span class="va">st</span><span class="op">$</span><span class="fu">destroy</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">st2</span><span class="op">$</span><span class="fu">destroy</span><span class="op">(</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

